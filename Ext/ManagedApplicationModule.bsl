///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2020, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

#Область ОписаниеПеременных

// СтандартныеПодсистемы

// Хранилище глобальных переменных.
//
// ПараметрыПриложения - Соответствие - хранилище переменных, где:
//   * Ключ - Строка - имя переменной в формате "ИмяБиблиотеки.ИмяПеременной";
//   * Значение - Произвольный - значение переменной.
//
// Инициализация (на примере СообщенияДляЖурналаРегистрации):
//   ИмяПараметра = "СтандартныеПодсистемы.СообщенияДляЖурналаРегистрации";
//   Если ПараметрыПриложения[ИмяПараметра] = Неопределено Тогда
//     ПараметрыПриложения.Вставить(ИмяПараметра, Новый СписокЗначений);
//   КонецЕсли;
//  
// Использование (на примере СообщенияДляЖурналаРегистрации):
//   ПараметрыПриложения["СтандартныеПодсистемы.СообщенияДляЖурналаРегистрации"].Добавить(...);
//   ПараметрыПриложения["СтандартныеПодсистемы.СообщенияДляЖурналаРегистрации"] = ...;
Перем ПараметрыПриложения Экспорт;

// Конец СтандартныеПодсистемы

//РаботаСВнешнимОборудованием
Перем глПодключаемоеОборудование Экспорт; // для кэширования на клиенте
Перем глПодключаемоеОборудованиеСобытиеОбработано Экспорт; // для предотвращения повторной обработки события

Перем глДоступныеТипыОборудования Экспорт;
//Конец РаботаСВнешнимОборудованием

#КонецОбласти

//++ЭЛИАС 20120625
Перем мИспользоватьМенеджерЛицензий Экспорт; // Признак использования Менеджера лицензий
//--ЭЛИАС 20120625

//++ЭЛИАС 20120625
Функция ЗапускМенеджераЛицензий() Экспорт

	Попытка
		АР_ОбщийМодульСЛК.Запуск();
	Исключение
		//Сообщить("Ошибка запуска СЛК: " + ОписаниеОшибки()); СВД
		Возврат Ложь;
	КонецПопытки;

	Возврат Истина;

КонецФункции //--ЭЛИАС 20120625

//++ЭЛИАС 20140307  
Процедура ИнициализироватьМенеджерЛицензий()
	
	мИспользоватьМенеджерЛицензий = Ложь;
	Если ЗапускМенеджераЛицензий() Тогда
		мИспользоватьМенеджерЛицензий = Истина;
	КонецЕсли;
	
КонецПроцедуры //--ЭЛИАС 20140307

//++ЭЛИАС 20131226  
Процедура ПриЗавершенииРаботыСистемы()
	
	АР_ОбщиеПроцедурыКлиентСервер.ОчиститьВременныеФайлыПросмотраПланировок();
	АР_ОбщиеПроцедурыКлиентСервер.ОчиститьВременныеФайлыШаблонов();
	
КонецПроцедуры //--ЭЛИАС 20131226

#Область ОбработчикиСобытий

Процедура ПередНачаломРаботыСистемы()
	
	// СтандартныеПодсистемы
	СтандартныеПодсистемыКлиент.ПередНачаломРаботыСистемы();
	// Конец СтандартныеПодсистемы
	
	// ИнтернетПоддержкаПользователей
	ИнтернетПоддержкаПользователейКлиент.ПередНачаломРаботыСистемы();
	// Конец ИнтернетПоддержкаПользователей
	
	// ПодключаемоеОборудование
	МенеджерОборудованияКлиент.ПередНачаломРаботыСистемы();
	// Конец ПодключаемоеОборудование
	
КонецПроцедуры

Процедура ПриНачалеРаботыСистемы()
	
	//++ЭЛИАС 20110510 Запуск СЛК
	Попытка
		ТекПользователь = ПользователиКлиентСервер.ТекущийПользователь();
		Если ЗначениеЗаполнено(ТекПользователь) И АР_ОбщиеПроцедуры.ЗначениеРеквизитаОбъекта(ТекПользователь, "АР_РаботатьСПодсистемойАренды") Тогда
			ИнициализироватьМенеджерЛицензий();	
		Иначе
			мИспользоватьМенеджерЛицензий = Ложь;
		КонецЕсли;
	Исключение
		// при обновлении БД запускаем СЛК без проверки прав пользователя
		ИнициализироватьМенеджерЛицензий();
	КонецПопытки;	
	//--ЭЛИАС 20110510
	
	// СтандартныеПодсистемы
	СтандартныеПодсистемыКлиент.ПриНачалеРаботыСистемы();
	// Конец СтандартныеПодсистемы
	
	//РаботаСВнешнимОборудованием
	МенеджерОборудованияКлиент.ПриНачалеРаботыСистемы();
	//Конец РаботаСВнешнимОборудованием
	
КонецПроцедуры

Процедура ПередЗавершениемРаботыСистемы(Отказ, ТекстПредупреждения)
	
	// СтандартныеПодсистемы
	СтандартныеПодсистемыКлиент.ПередЗавершениемРаботыСистемы(Отказ, ТекстПредупреждения);
	// Конец СтандартныеПодсистемы
	
	// ПодключаемоеОборудование
	МенеджерОборудованияКлиент.ПередЗавершениемРаботыСистемы();
	// Конец ПодключаемоеОборудование
	
КонецПроцедуры

Процедура ОбработкаВнешнегоСобытия(Источник, Событие, Данные)
	
	// ПодключаемоеОборудование
	// Подготовить данные
	
	ОписаниеСобытия = Новый Структура();
	ОписаниеОшибки  = "";
	
	ОписаниеСобытия.Вставить("Источник", Источник);
	ОписаниеСобытия.Вставить("Событие",  Событие);
	ОписаниеСобытия.Вставить("Данные",   Данные);
	
	глПодключаемоеОборудованиеСобытиеОбработано = Ложь;
	
	// Передать на обработку данные.
	Результат = МенеджерОборудованияКлиент.ОбработатьСобытиеОтУстройства(ОписаниеСобытия, ОписаниеОшибки);
	Если Не Результат Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru='При обработке внешнего события от устройства произошла ошибка.'")
		                                                 + Символы.ПС + ОписаниеОшибки);
	КонецЕсли;
	// Конец ПодключаемоеОборудование
	
КонецПроцедуры

#КонецОбласти

#Область Инициализация

глПодключаемоеОборудованиеСобытиеОбработано = Ложь;

#КонецОбласти